<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1083px" preserveAspectRatio="none" style="width:1418px;height:1083px;" version="1.1" viewBox="0 0 1418 1083" width="1418px" zoomAndPan="magnify"><defs><filter height="300%" id="fdczod3ie5o8y" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fdczod3ie5o8y)" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="609" x="702" y="917.4941"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="147" x2="147" y1="40.4883" y2="1039.7363"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="744" x2="744" y1="40.4883" y2="1039.7363"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1266" x2="1266" y1="40.4883" y2="1039.7363"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1359" x2="1359" y1="40.4883" y2="1039.7363"/><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="80" x="105" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="112" y="25.5352">WEB/User</text><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="80" x="105" y="1038.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="112" y="1059.2715">WEB/User</text><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="60" x="712" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="719" y="25.5352">IO PAY</text><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="60" x="712" y="1038.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="719" y="1059.2715">IO PAY</text><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="1231" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="1238" y="25.5352">pp-rest</text><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="1231" y="1038.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="1238" y="1059.2715">pp-rest</text><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="93" x="1311" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1318" y="25.5352">pp-logging</text><rect fill="#FEFECE" filter="url(#fdczod3ie5o8y)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="93" x="1311" y="1038.7363"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1318" y="1059.2715">pp-logging</text><polygon fill="#A80036" points="732,67.7988,742,71.7988,732,75.7988,736,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="147" x2="738" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="154" y="67.0566">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="167" y="67.0566">redirect to &lt;IO_PAY_URL&gt;/enterEmail.html?p&lt;ID_PAYMENT&gt;</text><polygon fill="#A80036" points="1254,97.1094,1264,101.1094,1254,105.1094,1258,101.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1260" y1="101.1094" y2="101.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="751" y="96.3672">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="764" y="96.3672">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="795" y="96.3672">payments/{idPayment}/actions/check</text><polygon fill="#A80036" points="755,126.4199,745,130.4199,755,134.4199,751,130.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="749" x2="1265" y1="130.4199" y2="130.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="761" y="125.6777">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="774" y="125.6777">Payment</text><path d="M452,143.4199 L452,198.4199 L1032,198.4199 L1032,153.4199 L1022,143.4199 L452,143.4199 " fill="#FBFB77" filter="url(#fdczod3ie5o8y)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1022,143.4199 L1022,153.4199 L1032,153.4199 L1022,143.4199 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="555" x="458" y="160.9883">`onload` page to check the correctness of the payment and retrieve the associated data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="519" x="462" y="176.2988">This call shall be unique to the entire payment session because it isn't idempotent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="502" x="462" y="191.6094">Although if it's a GET it writes on PM's DB and checks if payment already exists.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="147" x2="189" y1="229.6621" y2="229.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="189" x2="189" y1="229.6621" y2="242.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="148" x2="189" y1="242.6621" y2="242.6621"/><polygon fill="#A80036" points="158,238.6621,148,242.6621,158,246.6621,154,242.6621" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="154" y="224.9199">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="167" y="224.9199">The user insert/change mail and click `Continua`</text><polygon fill="#A80036" points="732,267.9727,742,271.9727,732,275.9727,736,271.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="147" x2="738" y1="271.9727" y2="271.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="154" y="267.2305">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="560" x="167" y="267.2305">The user insert credit card info and accepts terms &amp; privacy policy then click `Continua`</text><polygon fill="#A80036" points="1254,297.2832,1264,301.2832,1254,305.2832,1258,301.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1260" y1="301.2832" y2="301.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="751" y="296.541">6</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="764" y="296.541">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="803" y="296.541">users/actions/start-session{email, idPayment}</text><polygon fill="#A80036" points="755,326.5938,745,330.5938,755,334.5938,751,330.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="749" x2="1265" y1="330.5938" y2="330.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="761" y="325.8516">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="774" y="325.8516">OK {sessionToken,sessionUser}</text><polygon fill="#A80036" points="1254,355.9043,1264,359.9043,1254,363.9043,1258,359.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1260" y1="359.9043" y2="359.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="751" y="355.1621">8</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="764" y="355.1621">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="803" y="355.1621">/users/actions/approve-terms{terms, privacy}</text><polygon fill="#A80036" points="755,385.2148,745,389.2148,755,393.2148,751,389.2148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="749" x2="1265" y1="389.2148" y2="389.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="761" y="384.4727">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="774" y="384.4727">OK</text><path d="M641,402.2148 L641,427.2148 L843,427.2148 L843,412.2148 L833,402.2148 L641,402.2148 " fill="#FBFB77" filter="url(#fdczod3ie5o8y)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M833,402.2148 L833,412.2148 L843,412.2148 L833,402.2148 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="647" y="419.7832">Approve Term and Condition</text><polygon fill="#A80036" points="1347.5,453.8359,1357.5,457.8359,1347.5,461.8359,1351.5,457.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1353.5" y1="457.8359" y2="457.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="751" y="453.0938">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="773" y="453.0938">PUT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="804" y="453.0938">db-logging/logging/db/save event</text><polygon fill="#A80036" points="755,483.1465,745,487.1465,755,491.1465,751,487.1465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="749" x2="1265" y1="487.1465" y2="487.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="761" y="482.4043">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="783" y="482.4043">OK</text><polygon fill="#A80036" points="1254,512.457,1264,516.457,1254,520.457,1258,516.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1260" y1="516.457" y2="516.457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="751" y="511.7148">12</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="773" y="511.7148">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="812" y="511.7148">/wallet(wallet)</text><polygon fill="#A80036" points="755,541.7676,745,545.7676,755,549.7676,751,545.7676" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="749" x2="1265" y1="545.7676" y2="545.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="761" y="541.0254">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="783" y="541.0254">OK</text><path d="M520,558.7676 L520,598.7676 L963,598.7676 L963,568.7676 L953,558.7676 L520,558.7676 " fill="#FBFB77" filter="url(#fdczod3ie5o8y)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M953,558.7676 L953,568.7676 L963,568.7676 L953,558.7676 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="526" y="576.3359">addWallet returns a response with payment data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="418" x="530" y="591.6465">(wallet, data, card, and psp which contains the fixed costs amount</text><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="786" y1="629.6992" y2="629.6992"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786" x2="786" y1="629.6992" y2="642.6992"/><line style="stroke:#A80036;stroke-width:1.0;" x1="745" x2="786" y1="642.6992" y2="642.6992"/><polygon fill="#A80036" points="755,638.6992,745,642.6992,755,646.6992,751,642.6992" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="751" y="624.957">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="773" y="624.957">Summary page (wallet/summary)</text><polygon fill="#A80036" points="732,668.0098,742,672.0098,732,676.0098,736,672.0098" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="147" x2="738" y1="672.0098" y2="672.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="154" y="667.2676">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="176" y="667.2676">Confirm your payment, click on `Paga`</text><polygon fill="#A80036" points="1254,697.3203,1264,701.3203,1254,705.3203,1258,701.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1260" y1="701.3203" y2="701.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="751" y="696.5781">16</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="773" y="696.5781">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="437" x="812" y="696.5781">/payments/{idPayment}/actions/pay?language?it {idWallet,idPayment}</text><polygon fill="#A80036" points="755,726.6309,745,730.6309,755,734.6309,751,730.6309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="749" x2="1265" y1="730.6309" y2="730.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="761" y="725.8887">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="783" y="725.8887">OK (datiPagamento)</text><polygon fill="#A80036" points="1347.5,755.9414,1357.5,759.9414,1347.5,763.9414,1351.5,759.9414" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1353.5" y1="759.9414" y2="759.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="751" y="755.1992">18</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="773" y="755.1992">PUT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="804" y="755.1992">db-logging/logging/db/save event</text><polygon fill="#A80036" points="158,785.252,148,789.252,158,793.252,154,789.252" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="152" x2="743" y1="789.252" y2="789.252"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="164" y="784.5098">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="186" y="784.5098">UrlCheckout3ds</text><path d="M5,802.252 L5,842.252 L285,842.252 L285,812.252 L275,802.252 L5,802.252 " fill="#FBFB77" filter="url(#fdczod3ie5o8y)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M275,802.252 L275,812.252 L285,812.252 L275,802.252 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="11" y="819.8203">/wallet/resume?MD=MjI=&amp;PaRes=OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="11" y="835.1309">senza 3DS sia diretti alla view "checkout"</text><polygon fill="#A80036" points="732,869.1836,742,873.1836,732,877.1836,736,873.1836" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="147" x2="738" y1="873.1836" y2="873.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="154" y="868.4414">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="176" y="868.4414">OK 3DS</text><polygon fill="#A80036" points="1254,898.4941,1264,902.4941,1254,906.4941,1258,902.4941" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1260" y1="902.4941" y2="902.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="751" y="897.752">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="773" y="897.752">POST resume</text><path d="M702,917.4941 L776,917.4941 L776,924.4941 L766,934.4941 L702,934.4941 L702,917.4941 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="609" x="702" y="917.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="717" y="931.0625">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="791" y="930.1289">[TRANSACTION_RESULT_VIEW]</text><polygon fill="#A80036" points="1254,952.1152,1264,956.1152,1254,960.1152,1258,956.1152" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="744" x2="1260" y1="956.1152" y2="956.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="751" y="951.373">22</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="773" y="951.373">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="804" y="951.373">/v3/transactions/{TransactionId}/actions/check</text><polygon fill="#A80036" points="755,981.4258,745,985.4258,755,989.4258,751,985.4258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="749" x2="1265" y1="985.4258" y2="985.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="761" y="980.6836">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="783" y="980.6836">Ok</text><polygon fill="#A80036" points="158,1017.7363,148,1021.7363,158,1025.7363,154,1021.7363" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="152" x2="743" y1="1021.7363" y2="1021.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="164" y="1016.9941">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="186" y="1016.9941">transaction_result</text><!--MD5=[58f164eb4fe8af112528bfcf13a51f30]
@startuml doc/uml_diag/seqdiag-wisplight

autonumber 
participant web as "WEB/User"
participant wl as "IO PAY"
participant api as "pp-rest"
participant logging as "pp-logging"


autonumber 
participant web as "WEB/User"
participant wl as "WISP"
participant api as "pp-rest"
participant logging as "pp-logging"

web -> wl : redirect to <IO_PAY_URL>/enterEmail.html?p<ID_PAYMENT>

wl -> api : **GET** payments/{idPayment}/actions/check
api -> wl : Payment
note over wl: `onload` page to check the correctness of the payment and retrieve the associated data \n This call shall be unique to the entire payment session because it isn't idempotent \n Although if it's a GET it writes on PM's DB and checks if payment already exists.

web -> web :The user insert/change mail and click `Continua`

web -> wl :The user insert credit card info and accepts terms & privacy policy then click `Continua`

wl -> api : **POST** users/actions/start-session{email, idPayment}
api -> wl : OK {sessionToken,sessionUser}

wl -> api : **POST** /users/actions/approve-terms{terms, privacy}
api -> wl : OK
note over wl: Approve Term and Condition
wl -> logging : **PUT** db-logging/logging/db/save event

api -> wl : OK

wl -> api : **POST** /wallet(wallet) 
api -> wl : OK
note over wl: addWallet returns a response with payment data\n (wallet, data, card, and psp which contains the fixed costs amount

wl -> wl : Summary page (wallet/summary)

web -> wl :Confirm your payment, click on `Paga`

wl -> api : **POST** /payments/{idPayment}/actions/pay?language?it {idWallet,idPayment}


api -> wl : OK (datiPagamento)

wl -> logging : **PUT** db-logging/logging/db/save event

wl -> web : UrlCheckout3ds 
note over web: /wallet/resume?MD=MjI=&PaRes=OK\nsenza 3DS sia diretti alla view "checkout"

web -> wl: OK 3DS

wl -> api : POST resume

loop TRANSACTION_RESULT_VIEW
wl -> api : **GET** /v3/transactions/{TransactionId}/actions/check
api -> wl : Ok 
end

wl -> web : transaction_result

@enduml 

PlantUML version 1.2020.26(Mon Dec 21 18:45:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>